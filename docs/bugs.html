<!DOCTYPE html>
<html>
    <head>
        <meta content="text/html" charset="UTF-8" http-equiv="content-type">
        <title>BmsMaker3</title>
        <link rel="shortcut icon" href="favicon.ico">
        <link rel="stylesheet" type="text/css" href="style.css">
        <style>
            details.faq>summary{
                font-weight: bold;
                font-size: 150%;
            }
        </style>
    </head>
    <body>
        <div class="content">
            <div class="stack">
                <h1>既知の不具合</h1>
                <ul id="list">
                </ul>
            </div>
            <hr>
            <details class="faq">
                <summary><a href="browse_audio.html">Browseモード</a>などでエンコードした<span class="script">.ogg</span>が<a href="https://bmsoffighters.net/lr2/" target="_blank">LR2</a>で再生できない</summary>
                <ul>
                    <li>
                        <s>恐らく<b>LR2が古すぎる</b>のが原因です。</s><b>LR2が利用する<span class="script">fmodex.dll</span>の特定のバージョンに起因するバグです。</b>
                        <ul>
                            <li>
                                <a href="https://x.com/twinkle_haha/status/1963967002462335127" target="_blank">参考ポスト</a>
                            </li>
                            <li>
                                LR2に同梱されているFMOD Ex(0.4.13.4)が内部で使用しているVorbisデコーダーには、特定の構造(詳細不明)を持つファイルを再生できないバグがあります。
                            </li>
                            <li>
                                このバグはFMOD Exの後のバージョンで修正されていますが、<b style="color: #f44;">新しいバージョンではAPIの仕様変更があり、LR2はそれに対応していないため落ちます</b>。
                            </li>
                            <li>
                                この問題へのLR2側での対処法は以下の通りです。
                                <ol>
                                    <li>
                                        同梱されている<span class="script">fmodex.dll</span>を<b>古すぎず新しすぎないバージョン</b>に差し替える。
                                        <ul>
                                            <li>
                                                <a href="https://jp.dll-files.com/fmodex.dll.html" target="_blank">DLL-FILES.COM</a>から入手可能なFMOD Exの<b class="script">Versoin 0.4.33.7</b>が、LR2<span class="script">beta3 100201</span>では利用可能であり、問題の音声ファイルも正常に再生できることを確認しています。
                                            </li>
                                            <li>
                                                <b style="color: #f44;">上記サイトからのdllファイルのダウンロードは自己責任で行ってください。</b>
                                            </li>
                                            <li>
                                                このサイトで入手可能な一つ前のバージョン(0.4.26.2)ではバグは解消されておらず、一つ後のバージョン(0.4.38.7)はLR2では利用できない(落ちる)ため、このバージョンを選ぶ必要があります。
                                            </li>
                                            <li>
                                                ただし<a href="http://www.yamajet.com/bmssp/index.html" target="_blank">BMS Starter Pack 2009</a>に同梱されている<span class="script">beta3 090607</span>では、<b style="color: #f44;">0.4.33.7のFMOD Exも利用できない(楽曲読み込み時に落ちる)</b>ようです。
                                            </li>
                                        </ul>
                                    </li>
                                    <li>
                                        LR2のオプション(SYSTEMタブ)で「FMOD Exを使用しない」にチェックする
                                        <ul>
                                            <li>
                                                音声の再生にFMOD Exを使用しなくなるため、前述のバグを回避できます。
                                            </li>
                                            <li>
                                                この方法であれば<span class="script">beta3 090607</span>でも正常に音声が再生できるようになります。
                                            </li>
                                            <li>
                                                ただしこのオプションにチェックした場合、FMOD Exを利用したエフェクト機能(Reverbなど)は利用できなくなります。
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li>
                        現時点でBmsMaker3側での対応の目処は立っていません。
                        <ul>
                            <li>
                                LR2で確実に再生可能なデータを作成したい場合は、お手数をおかけしますが、当面は従来のエンコードツール(<a href="https://www.rarewares.org/ogg-oggdropxpd.php" target="_blank">oggdropXPd</a>や<a href="https://www.vector.co.jp/soft/winnt/art/se445019.html" target="_blank">えこでこツール</a>など)をご利用いただくようにお願いします。
                            </li>
                            <li>
                                なおBmsMaker3から出力される<span class="script">.ogg</span>そのものは正常なファイルであり、<a href="https://mistyblue.info/mbmplay.html" target="_blank">mBMplay</a>のようなモダンなアプリでは全て正常に再生可能です。
                            </li>
                        </ul>
                    </li>
                </ul>
                <br>
            </details>
            <details class="faq">
                <summary><a href="bms_flow.html">分岐へ降下中</a>にプレビューするとバグる</summary>
                <ul>
                    <li>
                        <b>ビューワーが<span class="script">#SETRANDOM</span>に対応していない</b>のが原因です。
                        <ul>
                            <li>
                                BmsMaker3では分岐への降下中にプレビューする際、内容が確定している<span class="script">#RANDOM</span>を<span class="script">#SETRANDOM</span>に変換することで分岐の固定を試みています。
                            </li>
                            <li>
                                しかし<a href="https://mistyblue.info/mbmplay.html" target="_blank">mBMplay</a>などは<span class="script">#SETRANDOM</span>に対応しておらず、<span class="script">#SETRANDOM</span>で囲まれた区間を分岐ではなくトップレベルに記述されていると解釈し、結果として<b>全ての分岐の内容が反映されてしまいます</b>。
                            </li>
                            <li>
                                ROKINAが確認した限り、<a href="https://bmsoffighters.net/lr2/" target="_blank">LR2</a>や<a href="https://mocha-repository.info/download.php" target="_blank">beatoraja</a>も同様に<span class="script">#SETRANDOM</span>に対応しておらず、実質的にこの分岐固定は機能していません。
                            </li>
                            <li>
                                解決策を模索中ですが、その対応には時間を要するため、当面は「分岐への降下中のプレビューはバグる」ことを前提としてプレビューを行ってください。
                            </li>
                        </ul>
                    </li>
                </ul>
                <br>
            </details>
            <details class="faq">
                <summary><a href="bms.html"><span class="script">F6</span>でプレビュー</a>すると「mBMplay」がエラーを吐く</summary>
                <ul>
                    <li>
                        <b>開始位置の引数に不正な値を渡している</b>ことが原因の、BmsMaker3側の不具合です。
                        <ul>
                            <li>
                                BMSモードで<span class="script">F6</span>(現在位置から再生)を行うと、BM3は「現在の小節位置の1つ前」を引数として各種ビューワーを起動します。
                            </li>
                            <li>
                                詳細は割愛しますが、現在(v0.7.41)のBM3には<b>スクロールバーが下端にある場合、この引数が<span class="script">-1</span>になる</b>という不具合があります。
                            </li>
                            <li>
                                <a href="https://mistyblue.info/mbmplay.html" target="_blank">mBMplay</a>は負の小節番号を許していないため、この引数によってエラーが発生します。
                            </li>
                            <li>
                                この不具合の解消は簡単ですが、緊急性が低いため、他の修正要素があった場合に次のアップデートでまとめて対応します。
                            </li>
                            <li>
                                当面の間、<b>スクロールバーが下端にある場合</b>は<span class="script">F6</span>ではなく<span class="script">F5</span>でプレビューするようにしてください。
                            </li>
                        </ul>
                    </li>
                </ul>
                <br>
            </details>
        </div>
        <script type="text/javascript" src="script.js"></script>
        <script type="text/javascript">
            (() => {
                const list = document.querySelector("ul#list");
                document.querySelectorAll("details.faq").forEach((element) => {
                    element.open = true;
                    const head = element.querySelector("summary");
                    if (head){
                        const title = head.textContent;
                        element.id = title;
                        const li = document.createElement("li");
                        const a = document.createElement("a");
                        a.href = "#" + title;
                        a.textContent = title;
                        li.appendChild(a);
                        list.appendChild(li);
                    }
                });
            })();
        </script>
    </body>
</html>
